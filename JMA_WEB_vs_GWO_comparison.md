# 気象庁WEB過去データと商用GWOデータベースの比較調査

## 調査日: 2025-11-09

---

## 1. 気象庁WEBで公開されている過去気象データ

### 1.1 提供サービス

#### サービス名
1. **過去の気象データ検索 (etrn)**
   - URL: https://www.data.jma.go.jp/stats/etrn/
   - HTML表示での閲覧が中心

2. **過去の気象データ・ダウンロード (obsdl)**
   - URL: https://www.data.jma.go.jp/risk/obsdl/
   - **注意**: 2025年2月20日以降メンテナンス中で利用不可

### 1.2 データ形式と仕様

#### CSVファイル仕様（obsdlサービス）
- **文字コード**: Shift_JIS
- **改行コード**: CRLF
- **形式**: カンマ区切り
- **構造**:
  - 第1行: ダウンロード時刻
  - 第2行以降: 表題行（集計期間、地点名、項目名など）
  - データ行: 観測値と付加情報

#### etrn（過去の気象データ検索）
- HTMLテーブル形式で表示
- 直接的なCSVダウンロード機能なし
- pandas read_htmlでスクレイピング可能

### 1.3 データ項目と単位

#### 時別値（1時間ごと）の主要項目
```
- 時: 時刻（1-24）
- 気圧(hPa): 現地、海面
- 降水量 (mm): 1時間降水量
- 気温 (℃): 気温
- 露点温度 (℃): 露点温度
- 蒸気圧 (hPa): 蒸気圧
- 湿度 (％): 相対湿度
- 風向・風速(m/s): 風速、風向
- 日照時間 (h): 日照時間
- 全天日射量 (MJ/㎡): 全天日射量
- 雪(cm): 降雪、積雪
- 天気: 天気コード（数値）
- 雲量: 雲量
- 視程 (km): 視程
```

### 1.4 欠損値と記号の表現

#### 主要な記号（etrn / obsdl共通）
- `--`: 該当現象なし、または該当現象による量等がない場合
- `×`: 欠測
- `///`: 欠測
- 空欄: 観測を行っていない、またはデータを掲載していない
- `0`: 1未満の現象
- `0.0`: 0.1未満の現象
- `0+`: 微量（雲量など）

#### 品質情報（obsdlで選択可能）
- `8`: 正常値（完全なデータ）
- `5`: 準正常値（80%以上の資料）
- `4`: 資料不足値（20-80%の資料）
- `2`: 疑問値
- `1`: 欠測
- `)`: 統計資料が許容範囲内で不完全
- `]`: 統計資料が許容範囲外で不足

#### 現象なし情報
- `1`: 現象なし
- `0`: 現象あり

### 1.5 観測地点

約1,500地点から観測データを提供
- 気象台: 降水量、風、気温、気圧、湿度など広範囲
- アメダス: 降水量、風、気温に限定される場合あり

### 1.6 利用可能な期間

- 主要地点: 1872年（明治5年）から
- 東京: 1875年頃から
- データの詳細度は時代により異なる

---

## 2. 商用GWO（気象データベース地上観測）の仕様

### 2.1 提供元
- （財）気象業務支援センター
- **販売終了**: 既に販売は終了（購入者はサポート継続）
- サポートサイト: http://www.roy.hi-ho.ne.jp/ssai/mito_gis/

### 2.2 収録期間と時間間隔

#### 時別データベース

**1961年～1990年:**
- **時間間隔**: 3時間置き
- **欠損項目**: 日照時間、全天日射量、降水量のデータなし
- **雲量・現在天気**: 3時～21時で3時間置き

**1991年～2020年:**
- **時間間隔**: 1時間置き
- **全項目利用可能**
- **雲量・現在天気**: 3時～21時で3時間置き

### 2.3 データ単位の特記事項

#### 全天日射量の単位変更
```
1961年～1980年:  1 cal/c㎡
1981年～2009年:  0.1 MJ/㎡
2010年以降:      0.01 MJ/㎡
```

#### 最低海面気圧の注意
```
1961年～2002年: 10000以上は10000が引かれている
2003年～2005年（オンラインデータ）: 同様に10000が引かれている
```

### 2.4 データ形式
- SQLViewer7.exeで切り出したCSVファイル
- 全地点全期間のデータを観測点別・年別に分割
- 2021年以前と2022年以降でフォーマットが異なる

---

## 3. 主な違いと注意点

### 3.1 アクセス方法
| 項目 | GWO（商用） | 気象庁WEB |
|------|------------|-----------|
| 入手方法 | DVD購入（販売終了） | WEB無償公開 |
| データ形式 | CSV（SQLViewer出力） | HTML/CSV |
| 利用期限 | 購入後永続 | 常時アクセス可能 |

### 3.2 データ形式の違い

#### GWO
- 独自の単位系（時代により変更あり）
- SQLViewerでの一括抽出
- 2021年以前と2022年以降でフォーマット異なる

#### 気象庁WEB（etrn）
- **気象庁互換形式**（2022年以降、README参照）
- 気象庁公式の最新単位系
- 数値または記号を含む形式を選択可能

### 3.3 データ内容の違い

**同一の可能性が高い項目:**
- 1991年以降の1時間置きデータ
- 気温、湿度、気圧、風向・風速などの基本項目

**異なる可能性がある項目:**
- 全天日射量の単位（時代により変換が必要）
- 最低海面気圧（10000の補正）
- 1990年以前のデータ（3時間置き vs 利用可能性）

### 3.4 品質情報・リマーク（RMK）

#### GWO (mod_class_met.py より)
```python
rmk = {
    "0": "観測値が未作成の場合",
    "1": "欠測",
    "2": "観測していない場合",
    "3": "日の極値が真の値以下の場合，該当現象がない推定値の場合",
    "4": "日の極値が真の値以上の場合，該当現象がない地域気象観測データを使用する場合",
    "5": "推定値が含まれる場合，または２４回平均値で欠測を含む場合",
    "6": "該当する現象がない場合（降水量，日照時間，降雪，積雪，最低海面気圧）",
    "7": "日の極値の起時が前日の場合",
    "8": "正常な観測値",
    "9": "日の極値の起時が翌日の場合，または１９９０年までの８０型地上気象観測装置からの自動取得値"
}
```

#### 気象庁WEB
- 品質情報の表示/非表示を選択可能
- 数値のみまたは記号を含む形式を選択可能
- 均質番号による観測環境変化の追跡

---

## 4. 推奨される利用方法

### 4.1 新規データ取得の場合
**気象庁WEB（etrn）を推奨**
- 最新の気象庁公式データ
- 無償で利用可能
- 今回作成した `jma_weather_downloader.py` で自動化可能

### 4.2 既存GWOデータとの継続利用
**両方を適切に使い分け**
- 1990年以前: GWOデータベース（3時間置きでも貴重）
- 1991年以降: 気象庁WEBで取得可能
- ただし、単位の換算と品質情報の対応付けが必要

### 4.3 データ統合時の注意点

1. **単位の統一**: 全天日射量の単位変換
2. **欠損値の統一**: `--`, `×`, `空欄` などの統一処理
3. **品質情報の統一**: RMK値と品質情報の対応付け
4. **時間間隔**: 1990年以前の3時間データと1991年以降の1時間データの処理

---

## 5. 結論

### 内容の同一性
**1991年以降のデータ**: ほぼ同一と考えられる（気象庁の公式データが元）
**1990年以前のデータ**: 時間間隔が異なるため直接比較困難

### フォーマットの同一性
**異なる**:
- GWOは独自のCSV形式（SQLViewer出力）
- 気象庁WEBはHTML/CSV（記号表現や品質情報の表示方法が異なる）

### 推奨アプローチ
1. 新規データは気象庁WEBから取得
2. 既存GWOデータは貴重な資産として保持
3. mod_class_met.pyのようなデータ統合クラスで両者を扱う

---

## 参考資料
- 気象庁 過去の気象データ検索: https://www.data.jma.go.jp/stats/etrn/
- 気象庁 値欄の記号の説明: https://www.data.jma.go.jp/obd/stats/data/mdrr/man/remark.html
- 気象庁 CSVダウンロード仕様: https://www.data.jma.go.jp/risk/obsdl/top/help3.html
- GWO README.md: 本リポジトリ内
